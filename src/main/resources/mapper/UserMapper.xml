<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.unicon.user.mapper.UserMapper">

    <select id="findByEmail" resultType="com.example.unicon.user.vo.UserVO">
        SELECT user_id AS id, tenant_id, name AS userName, email, password, role
        FROM user
        WHERE email = #{email}
    </select>

    <select id="findUserWithTenantByEmailAndSubdomain" resultType="com.example.unicon.user.vo.UserVO">
        SELECT
            u.user_id AS id,
            u.tenant_id,
            u.name AS userName, -- u.user_name -> u.name, 별칭은 userName으로 유지
            u.email,
            u.password,
            u.role,
            t.is_active AS isActive, -- t.is_active를 UserVO의 isActive 필드에 매핑
            t.name AS tenantName,
            t.sub_domain AS subDomain
        FROM
            user u
                JOIN
            tenant t ON u.tenant_id = t.tenant_id
        WHERE
            u.email = #{email} AND t.sub_domain = #{subdomain}
    </select>

    <insert id="insertUser" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO user (tenant_id, name, email, password, role, created_at)
        VALUES (#{tenantId}, #{userName}, #{email}, #{password}, #{role}, NOW())
    </insert>

</mapper>